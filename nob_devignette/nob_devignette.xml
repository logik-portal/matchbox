<ShaderNodePreset
    Description="This Matchbox shader compensates for vignetting.

Up to four reference points can be defined as radii and the respective gain compensation, optionally separate for red, green &amp; blue colour channels. The vignetting centre is treated as an implicit fifth point with unchanged gain.
The shader calculates an even polynomial of eighth degree (in the radius from the vignetting centre) to interpolate those points.
This kind of interpolation may lead to undesired oscillations for higher numbers of data points. However with sensible spacing of radii and lens vignetting being a rather smooth function, so to say, oscillations or overshoot is hardly an issue.

Note that this shader does not perform any image scaling or reformatting, so the operation may be incorrect if the result image format does not match the input image format.
It is recommended to leave the canvas resolution as &lt;Same As Input 1&gt;.

This shader is licensed under the terms of the MIT license.

For questions contact:
nobbl211@gmail.com"
    Name="Devignette"
    HelpLink=""
    LimitInputsToTexture="True"
    MatteProvider="False"
    SupportsAction="True"
    SupportsTransition="False"
    SupportsAdaptiveDegradation="False"
    CommercialUsePermitted="True"
    ShaderType="Matchbox"
    SoftwareVersion="2024.1"
    TimelineUseBack="False"
    SupportsTimeline="True"
    Version="0.3">
    <Shader
        Index="1"
        OutputBitDepth="Float32"
        OutputWidth="3"
        OutputHeight="2">
        <Uniform
            Type="sampler2D"
            DisplayName="Front"
            Name="front"
            Index="0"
            NoInput="Error"
            Mipmaps="False"
            InputType="Front">
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="enable the first ring"
            DisplayName="Enable"
            ChannelName="ring_1"
            Name="ring_1"
            Col="0"
            Row="0"
            Page="0"
            Default="False">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="relative radius of the first vignetting ring"
            DisplayName="Radius"
            ChannelName="r_1"
            Name="r_1"
            Col="0"
            Row="1"
            Page="0"
            Default="0.255"
            Inc="0.001"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="None"
            UIConditionSource="use_px"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="radius of the first vignetting ring in pixels"
            DisplayName="Radius"
            ChannelName="r_1_px"
            Name="r_1_px"
            Col="0"
            Row="1"
            Page="0"
            Default="551"
            Inc="2"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="Height"
            UIConditionSource="use_px"
            UIConditionValue="True"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="gain correction of the first vignetting ring"
            DisplayName="Gain"
            ChannelName="y_1"
            Name="y_1"
            Col="0"
            Row="2"
            Page="0"
            ResDependant="None"
            Default="0.0"
            Inc="0.001"
            Max="1000000.0"
            Min="-1.0"
            UIConditionSource="enable_rgb"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="vec3"
            Tooltip="gain correction per RGB channel of the first vignetting ring"
            DisplayName="RGB gain"
            ChannelName="rgb_1"
            Name="rgb_1"
            Page="0"
            Col="0"
            Row="2"
            IconType="None"
            ValueType="Position"
            UIConditionSource="enable_rgb"
            UIConditionValue="True"
            UIConditionType="Hide">
            <SubUniform
                DisplayName="R"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="G"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="B"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="enable the second ring"
            DisplayName="Enable"
            ChannelName="ring_2"
            Name="ring_2"
            Col="1"
            Row="0"
            Page="0"
            Default="False">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="relative radius of the second vignetting ring"
            DisplayName="Radius"
            ChannelName="r_2"
            Name="r_2"
            Col="1"
            Row="1"
            Page="0"
            Default="0.5099"
            Inc="0.001"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="None"
            UIConditionSource="use_px"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="radius of the second vignetting ring in pixels"
            DisplayName="Radius"
            ChannelName="r_2_px"
            Name="r_2_px"
            Col="1"
            Row="1"
            Page="0"
            Default="1101"
            Inc="2"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="Height"
            UIConditionSource="use_px"
            UIConditionValue="True"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="gain correction of the second vignetting ring"
            DisplayName="Gain"
            ChannelName="y_2"
            Name="y_2"
            Col="1"
            Row="2"
            Page="0"
            ResDependant="None"
            Default="0.0"
            Inc="0.001"
            Max="1000000.0"
            Min="-1.0"
            UIConditionSource="enable_rgb"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="vec3"
            Tooltip="gain correction per RGB channel of the second vignetting ring"
            DisplayName="RGB gain"
            ChannelName="rgb_2"
            Name="rgb_2"
            Page="0"
            Col="1"
            Row="2"
            IconType="None"
            ValueType="Position"
            UIConditionSource="enable_rgb"
            UIConditionValue="True"
            UIConditionType="Hide">
            <SubUniform
                DisplayName="R"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="G"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="B"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="enable the third ring"
            DisplayName="Enable"
            ChannelName="ring_3"
            Name="ring_3"
            Col="2"
            Row="0"
            Page="0"
            Default="False">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="relative radius of the third vignetting ring"
            DisplayName="Radius"
            ChannelName="r_3"
            Name="r_3"
            Col="2"
            Row="1"
            Page="0"
            Default="0.7649"
            Inc="0.001"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="None"
            UIConditionSource="use_px"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="radius of the third vignetting ring in pixels"
            DisplayName="Radius"
            ChannelName="r_3_px"
            Name="r_3_px"
            Col="2"
            Row="1"
            Page="0"
            Default="1652"
            Inc="2"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="Height"
            UIConditionSource="use_px"
            UIConditionValue="True"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="gain correction of the third vignetting ring"
            DisplayName="Gain"
            ChannelName="y_3"
            Name="y_3"
            Col="2"
            Row="2"
            Page="0"
            ResDependant="None"
            Default="0.0"
            Inc="0.001"
            Max="1000000.0"
            Min="-1.0"
            UIConditionSource="enable_rgb"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="vec3"
            Tooltip="gain correction per RGB channel of the third vignetting ring"
            DisplayName="RGB gain"
            ChannelName="rgb_3"
            Name="rgb_3"
            Page="0"
            Col="2"
            Row="2"
            IconType="None"
            ValueType="Position"
            UIConditionSource="enable_rgb"
            UIConditionValue="True"
            UIConditionType="Hide">
            <SubUniform
                DisplayName="R"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="G"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="B"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="enable the fourth ring"
            DisplayName="Enable"
            ChannelName="ring_4"
            Name="ring_4"
            Col="3"
            Row="0"
            Page="0"
            Default="True">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="relative radius of the fourth vignetting ring"
            DisplayName="Radius"
            ChannelName="r_4"
            Name="r_4"
            Col="3"
            Row="1"
            Page="0"
            Default="1.02"
            Inc="0.001"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="None"
            UIConditionSource="use_px"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="radius of the fourth vignetting ring in pixels"
            DisplayName="Radius"
            ChannelName="r_4_px"
            Name="r_4_px"
            Col="3"
            Row="1"
            Page="0"
            Default="2203"
            Inc="2"
            Max="1000000.0"
            Min="0.000001"
            ResDependant="Height"
            UIConditionSource="use_px"
            UIConditionValue="True"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="gain correction of the fourth vignetting ring"
            DisplayName="Gain"
            ChannelName="y_4"
            Name="y_4"
            Col="3"
            Row="2"
            Page="0"
            ResDependant="None"
            Default="0.0"
            Inc="0.001"
            Max="1000000.0"
            Min="-1.0"
            UIConditionSource="enable_rgb"
            UIConditionValue="False"
            UIConditionType="Hide">
        </Uniform>
        <Uniform
            Type="vec3"
            Tooltip="gain correction per RGB channel of the fourth vignetting ring"
            DisplayName="RGB gain"
            ChannelName="rgb_4"
            Name="rgb_4"
            Page="0"
            Col="3"
            Row="2"
            IconType="None"
            ValueType="Position"
            UIConditionSource="enable_rgb"
            UIConditionValue="True"
            UIConditionType="Hide">
            <SubUniform
                DisplayName="R"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="G"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
            <SubUniform
                DisplayName="B"
                ResDependant="None"
                Default="0.0"
                Inc="0.001"
                Max="1000000.0"
                Min="-1.0">
            </SubUniform>
        </Uniform>
        <Uniform
            Type="vec2"
            Tooltip="position of the vignetting centre relative to the source image"
            DisplayName="Centre"
            ChannelName="centre"
            Name="centre"
            Col="4"
            Row="0"
            Page="0"
            IconType="Axis"
            IconDefaultState="Falase"
            Action3DWidgets="False"
            ValueType="Position"
            UIConditionSource="use_px"
            UIConditionValue="False"
            UIConditionType="Hide">
            <SubUniform
                Default="0.5"
                Inc="0.001"
                Max="1000000.0"
                Min="-1000000.0"
                ResDependant="None">
            </SubUniform>
            <SubUniform
                Default="0.5"
                Inc="0.001"
                Max="1000000.0"
                Min="-1000000.0"
                ResDependant="None">
            </SubUniform>
        </Uniform>
        <Uniform
            Type="vec2"
            Tooltip="position of the vignetting centre in pixels of the source image centre"
            DisplayName="Centre"
            ChannelName="centre_px"
            Name="centre_px"
            Col="4"
            Row="0"
            Page="0"
            IconType="None"
            ValueType="Position"
            UIConditionSource="use_px"
            UIConditionValue="True"
            UIConditionType="Hide">
            <SubUniform
                Default="0.0"
                Inc="2.0"
                Max="1000000.0"
                Min="-1000000.0"
                ResDependant="Width">
            </SubUniform>
            <SubUniform
                Default="0.0"
                Inc="2.0"
                Max="1000000.0"
                Min="-1000000.0"
                ResDependant="Height">
            </SubUniform>
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="use pixels as a unit of measurement insted of relative units"
            DisplayName="Use Pixels"
            ChannelName="use_px"
            Name="use_px"
            Col="5"
            Row="1"
            Page="0"
            Default="False">
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="enable separate coltrol over red, green and blue gain for vignetting compensation"
            DisplayName="Enable RGB Compensation"
            ChannelName="enable_rgb"
            Name="enable_rgb"
            Col="5"
            Row="2"
            Page="0"
            Default="False">
        </Uniform>
    </Shader>
    <Shader
        Index="2"
        OutputBitDepth="Output">
        <Uniform
            Type="sampler2D"
            DisplayName="Front"
            Name="front"
            Index="0"
            NoInput="Error"
            Mipmaps="False"
            InputType="Front">
        </Uniform>
        <Uniform
            Type="sampler2D"
            Name="adsk_results_pass1"
            Mipmaps="False">
        </Uniform>
        <Uniform
            Type="bool"
            Name="ring_1">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_1">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_1_px">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="bool"
            Name="ring_2">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_2">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_2_px">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="bool"
            Name="ring_3">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_3">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_3_px">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="bool"
            Name="ring_4">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_4">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Name="r_4_px">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="float"
            Tooltip="horizontal strech factor"
            DisplayName="Anamorphic"
            ChannelName="anamorphic"
            Name="anamorphic"
            Col="4"
            Row="2"
            Page="0"
            Default="1.0"
            Inc="0.01"
            Max="1000000.0"
            Min="0.0"
            ResDependant="None">
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="overlay the result with visual repreesentations of the compensation rings
the rings are color coded ascending in index: red, green, blue, magenta"
            DisplayName="Highlight Rings"
            ChannelName="highlight_rings"
            Name="highlight_rings"
            Col="5"
            Row="0"
            Page="0"
            Default="False">
        </Uniform>
        <Uniform
            Type="bool"
            Name="use_px">
            <Duplicate>
            </Duplicate>
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="apply the vignetting compensation to a white source instead of the Front input"
            DisplayName="Compensation Only"
            ChannelName="compensation"
            Name="compensation"
            Col="5"
            Row="3"
            Page="0"
            Default="False">
        </Uniform>
        <Uniform
            Type="bool"
            Tooltip="apply the inverted gain compensation to the image"
            DisplayName="Invert Compensation"
            ChannelName="invert"
            Name="invert"
            Col="5"
            Row="4"
            Page="0"
            Default="False">
        </Uniform>
    </Shader>
    <Page
        Name="Controls"
        ColName0_2="Rings 1-3"
        ColName3_5="4 and Settings"
        Page="0">
        <Col
            Name="Ring 1"
            Col="0"
            Page="0">
        </Col>
        <Col
            Name="Ring 2"
            Col="1"
            Page="0">
        </Col>
        <Col
            Name="Ring 3"
            Col="2"
            Page="0">
        </Col>
        <Col
            Name="Ring 4"
            Col="3"
            Page="0">
        </Col>
        <Col
            Name="Settings"
            Col="4"
            Page="0">
        </Col>
        <Col
            Name="Toggles"
            Col="5"
            Page="0">
        </Col>
    </Page>
</ShaderNodePreset>